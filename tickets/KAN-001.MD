Title
Epic filter causes invalid HTML nesting: <button> inside <button> (React validateDOMNesting warning)

Type
Bug

Priority / Severity
P2 – visible runtime warnings; can break keyboard/a11y behavior inside dropdown

Component(s)
UI → Filters / Dropdown / Button

Environment

App: Backlog view

Browser: Chrome 140 (desktop)

Framework: Next.js (Fast Refresh active)

Repro date: 13 Sep 2025 (Europe/London)

Description
React logs validateDOMNesting because the Epic filter dropdown renders a <button> inside a <button>. Our DropdownTrigger renders a button, and we nest our Button (also a button) within it. This violates HTML semantics and may interfere with focus, clicks, and screen readers.

Console also shows:

Connect(Droppable): Support for defaultProps will be removed from memo components (library/deprecation noise).

Preload warning: a preloaded asset isn’t used promptly or has wrong as= type.

Error / Logs

Warning: validateDOMNesting(...): <button> cannot appear as a descendant of <button>.
    at button
    at _c (button.tsx:17:7)
    at button
    at _c (dropdown-menu.tsx:17:6)
    at EpicFilter (filter-epic.tsx:19:48)


Files involved (from stack trace / snippet)

components/filters/filter-epic.tsx (the EpicFilter component)

components/ui/dropdown-menu.tsx (DropdownTrigger/DropdownItem)

components/ui/button.tsx (Button)

(Secondary) components/ui/accordion.tsx (defaultProps deprecation path)

(Secondary) app/(project)/layout.tsx or _document.tsx / head.tsx (preload link)

I don’t have your repo’s line numbers; below changes reference the functions/components to modify. Please update exact spans in the PR.

Steps to Reproduce

Open Backlog → header “Epic” filter.

Click the Epic dropdown.

Observe console: validateDOMNesting warning.

Expected

No DOM nesting warnings.

Dropdown trigger renders a single interactive element.

Checkbox items are valid and keyboard accessible.

Actual

<Button> (renders <button>) is nested inside <DropdownTrigger> (also renders <button>).

Inputs placed inside an interactive DropdownItem (likely a button) further risk invalid nesting.

Business Impact

A11y and interaction bugs inside filters degrade UX for evaluation users; noisy console in demos hurts perceived quality, impacting trial → paid conversion for project management features.

Acceptance Criteria

 No validateDOMNesting warnings when opening/using Epic dropdown.

 Trigger uses child button via asChild (or trigger is styled and inner button removed).

 Each epic checkbox has a unique id and the onChange is on the <input>.

 No interactive controls inside an interactive DropdownItem unless the item is asChild with a non-button wrapper, or a CheckboxItem is used.

 Preload warning resolved (correct as= and/or remove unused preload).

 Unit test renders EpicFilter and asserts structure (no nested buttons).

Proposed Fix (UI)

Make trigger pass-through to our Button (Radix/shadcn style):
in components/ui/dropdown-menu.tsx ensure DropdownTrigger supports asChild and forwards refs/props.

Update EpicFilter trigger usage:

// components/filters/filter-epic.tsx
<Dropdown>
  <DropdownTrigger asChild>
    <Button className="flex items-center gap-x-2" customColors>
      <span className="text-sm">Epic</span>
      <CountBall count={epics.length} className="bg-inprogress text-xs text-white" hideOnZero />
      <FaChevronDown className="text-xs" />
    </Button>
  </DropdownTrigger>
  {/* ... */}
</Dropdown>


Make checkbox items valid & accessible (no input inside a button). Either:
Option A (preferred): use a CheckboxItem component from your dropdown library.
Option B: render DropdownItem asChild with a div, and put the <input> inside that div:

<DropdownItem asChild onSelect={(e) => e.preventDefault()}>
  <div className="px-3 py-1.5 text-sm hover:bg-gray-100">
    <input
      type="checkbox"
      id={`epic-filter-${issue.id}`}
      className="form-checkbox h-3 w-3 rounded-sm text-inprogress"
      checked={epics.includes(issue.id)}
      onChange={(e) => onSelectChange(e, issue)}
    />
    <label htmlFor={`epic-filter-${issue.id}`} className="sr-only">
      Epic filter checkbox
    </label>
    <TooltipWrapper text={issue.name}>
      <span className="text-sm text-gray-700">{issue.name}</span>
    </TooltipWrapper>
  </div>
</DropdownItem>


Preload warning: audit any <link rel="preload"> in app/(project)/layout.tsx or _document.tsx.

Ensure correct as= (style, font, script, image, etc.) and crossorigin for fonts.

Remove the preload if the asset isn’t used early.

Proposed Fix (Deprecation Noise)

Search for defaultProps on memoized components in components/ui/accordion.tsx and others; switch to default parameters:

// before
MyComp.defaultProps = { expanded: false };
// after
function MyComp({ expanded = false }: { expanded?: boolean }) { /* ... */ }


Library note: if warning originates in react-beautiful-dnd, consider @hello-pangea/dnd or accept warning until lib upgrade.

Test Plan

Unit: render EpicFilter with a mock list of issues; query the trigger node and assert it’s a single button (no nested button).

Unit: verify checking/unchecking calls setEpics correctly.

Accessibility smoke: keyboard open/close of dropdown; tab into checkbox; Space toggles.

Manual: verify console is clean while opening/using dropdown; verify preloaded asset warning gone.

Observability

(Optional) Add a client log counter around EpicFilter mount to detect unexpected errors; surface to Sentry as breadcrumb (exclude benign warnings).

Definition of Done

All Acceptance Criteria green; PR includes screenshots of console before/after.

Assignee / DRI
@<Your-Name>

Labels
ui, a11y, react, dropdown, backlog-view

Linked Work

Follow-up chore: “Replace deprecated defaultProps in memo components”

Follow-up chore: “Preload audit in layout/head”

Monetization linkage (context)

Cleaner, accessible filters improve discoverability of work items → better first-run experience and trial conversion for the Kanban/backlog module.

References (code locations to change)

components/filters/filter-epic.tsx → EpicFilter trigger & item markup.

components/ui/dropdown-menu.tsx → ensure DropdownTrigger supports asChild.

components/ui/accordion.tsx (and others) → remove defaultProps on memo components.

app/(project)/layout.tsx or _document.tsx → fix/remove preload link.